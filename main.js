(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-34",headers:{authorization:"98e2ee8c-3458-4b67-a2fc-bc47b2fb0b6d","Content-Type":"application/json"}};function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o),e.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",r)}))}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o),e.querySelectorAll(".popup__close").forEach((function(e){e.removeEventListener("click",r)}))}function o(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}function r(){var e=document.querySelector(".popup_is-opened");e&&n(e)}function c(t,n,o){var r=n.likes.some((function(e){return e._id===o}));(function(t,n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:n?"DELETE":"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})(n._id,r).then((function(e){n.likes=e.likes,t.target.classList.toggle("card__like-button_is-active",!r),t.target.nextElementSibling.textContent=e.likes.length})).catch((function(e){console.log(e)}))}function a(e,o,r,c,a){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image");i.src=e.link,i.alt=e.name,i.addEventListener("click",(function(){return r(e)})),u.querySelector(".card__title").textContent=e.name;var l=u.querySelector(".card__like-button"),s=e.likes.some((function(e){return e._id===a}));l.classList.toggle("card__like-button_is-active",s),l.addEventListener("click",(function(t){c(t,e,a)})),u.querySelector(".card__like-sum").textContent=e.likes.length;var d=u.querySelector(".card__delete-button"),p=document.querySelector("#popup_delete-agreement-template").content.querySelector(".popup");if(e.owner._id!==a)d.style.display="none";else{var f=p.cloneNode(!0),m=f.querySelector(".popup__button-agreement");document.body.append(f),d.addEventListener("click",(function(){m.addEventListener("click",(function(t){o(u,e),n(f),f.remove()})),t(f)}))}return u}function u(t,n){var o;(o=n._id,fetch("".concat(e.baseUrl,"/cards/").concat(o),{method:"DELETE",headers:e.headers})).then((function(){t.remove()})).catch((function(e){console.log(e)}))}function i(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function l(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function s(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){i(e,n,t)})),l(n,o,t)}var d=document.querySelector(".popup__input_type_name"),p=document.querySelector(".popup__input_type_description"),f=document.querySelector(".profile__title"),m=document.querySelector(".profile__description"),_=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector('form[name="edit-profile"]'),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),g=document.querySelector(".profile__image"),k=document.querySelector(".popup_type_edit-avatar"),E=document.querySelector(".popup__input_type_avatar_url"),L=document.querySelector('form[name="update-avatar"]'),C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};g.addEventListener("click",(function(){E.value=g.style.backgroundImage.replace(/^url\(["']?|["']?\)$/g,""),s(k,C),t(k)})),L.addEventListener("submit",(function(t){var o;t.preventDefault(),T(!0),(o=E.value.trim(),fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:o}),headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){g.style.backgroundImage='url("'.concat(e.avatar,'")'),L.reset(),n(t.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){T(!1)}))})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){d.value=f.textContent,p.value=m.textContent,s(y,C),t(y)})),document.querySelector(".profile__add-button").addEventListener("click",(function(){s(v,C),t(v)})),document.addEventListener("click",(function(e){e.target.classList.contains("popup")&&n(e.target)})),h.addEventListener("submit",(function(t){t.preventDefault(),T(!0);var o,r,c=d.value,a=p.value;(o=c,r=a,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:o,about:r}),headers:e.headers})).then((function(e){f.textContent=c,m.textContent=a,h.reset(),n(t.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){T(!1)}))}));var x=document.querySelector('form[name="new-place"]'),j=document.querySelector(".popup__input_type_card-name"),A=document.querySelector(".popup__input_type_url");function P(e){b.src=e.link,b.alt=e.name,q.textContent=e.name,t(S)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);l(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),l(n,o,t)}))}))}(t,e)}))}(C),fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){var o;g.style.backgroundImage='url("'.concat(t.avatar,'")'),f.textContent=t.name,m.textContent=t.about,o=t._id,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=a(e,u,P,c,o);_.append(t)}))})).catch((function(e){console.log(e)})),x.addEventListener("submit",(function(o){!function(t,o){var r,i;t.preventDefault(),T(!0),(r=j.value,i=A.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:r,link:i}),headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var r=a(e,u,P,c,o);_.prepend(r),x.reset(),n(t.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){T(!1)}))}(o,t._id)}))})).catch((function(e){console.log(e)}));var U=document.querySelectorAll(".popup__button"),T=function(e){U.forEach((function(t){t.textContent=e?"Сохранение...":"Сохранить"}))}})();